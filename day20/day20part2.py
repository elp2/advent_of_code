INPUT="""                                         R           L   A       D     U         R     S
                                         W           H   C       B     F         Y     M
  #######################################.###########.###.#######.#####.#########.#####.#######################################
  #.#.........#.....#...#.......................#.#...#.....#.......#.....#.....#.....#.................#...#.#.#...........#.#
  #.#####.###.#####.###.###.###.#######.#########.#.###.#######.###.#.#########.#.#######.#####.###.#.#.###.#.#.#.###.#.#####.#
  #.......#...#.#.#...#.#...#.#.#...#.#.....#.#...#...#.......#.#...#.......#...#.#...........#...#.#.#.............#.#.#.#...#
  #.###.###.#.#.#.#.###.#####.#####.#.###.###.#.#.###.###.#####.###.###.#######.#.###.###.#.#####.###.#######.#####.#####.###.#
  #.#.#.#...#.#.#.........#.....#...........#...#.....#...#.#...#...#.........#...#...#.#.#...#.#.#.#.#...#.#.#.#.............#
  #.#.#######.#.#######.#####.###.#####.###.###.#######.###.#####.#.#.#######.###.#.###.#####.#.###.###.###.###.#######.#######
  #.#...#...................#.#.#.#.....#.....#...#.......#.....#.#.#.....#...#.#.#.........#...#.#...#.#.........#...#.#.....#
  ###.#####.###.#.#.#.###.###.#.###.###.#.#.#####.###.#.#####.#.#.###.#.#######.#.#.###.#.#.#.#.#.###.#.#.#####.###.#######.###
  #...#.#...#.#.#.#.#.#.#...#...#...#...#.#.#.....#...#.#...#.#.#...#.#.#.....#...#...#.#.#.#.#.#.#.#.....#.#.#.#.......#.#.#.#
  ###.#.#####.#####.###.#.#.#.#########.#######.#.###.#.###.#.#.###.#.#.#.#######.#.###########.#.#.#.#.###.#.###.#.#.#.#.#.#.#
  #.#.....#...........#...#...........#.#...#...#.#.#.#...#...#.....#.#...#.#...#.#.......#...#.#.#...#.#.#.......#.#.#.#.#...#
  #.###.#####.#######################.#.#.#####.###.###.#####.#######.###.#.#.#.#.#.#########.###.###.###.#.#####.#######.###.#
  #.#...#.....#.............#...........#.#.#.........#.#.........#...#...#...#.#.#.#.#...#...#...............#.....#.#.#...#.#
  #.###.#####.###.#.#######.#########.#.#.#.###.#####.#.#####.#.#.#######.#.#.###.#.#.#.#####.###.#.#.#.###.#.#####.#.#.#.###.#
  #.#...#.......#.#.#.......#...#...#.#.....#.....#...#.#.#.#.#.#...#.....#.#.....#.........#.#...#.#.#.#.#.#.#...#.#.#.......#
  #.#.#.#####.#########.###.#.#####.#####.#####.#######.#.#.#.#.###.#.###.#.#.#.#.###.#####.#.#.#.#.#####.#####.#####.#.###.###
  #.#.#...#.#.#.#.....#.#.................#...........#.....#.#.#...#.#.#.#.#.#.#.#.......#.#.#.#.#.#.........#.......#.#.....#
  #.#.#####.###.#.###.###########.#.###.#########.#######.#########.#.#.#########.#.#########.#.#####.###.#########.#######.###
  #.....#...#.#.#.#...#...#.....#.#.#...#.#.#.#.#...#.........#.....#.....#.......#.....#.#.#.....#.....#.#.#.#.......#.#...#.#
  #.#######.#.#.#####.#.#.###.###.#####.#.#.#.#.#.#####.#########.###.#####.###.###.#.###.#.#.###.#.#######.#.###.#####.###.#.#
  #.#.......#.#.#.#.#.#.#.........#...#.#.#...#...#...#.#.#...#.....#...#...#.#.#.#.#...#...#.#...........#...#.#.#.#.....#...#
  #.#.#######.#.#.#.#.###.###.#####.#.#.#.#.#.#.###.#.#.#.#.#######.#.#######.#.#.#.#.###.###.###.#.#########.#.#.#.#####.#.###
  #.#.....#.#...........#.#.......#.#.....#.#.#.....#.#.........#...#...#.#.......#.#...........#.#.#.#.#.#.#.#.....#.#.......#
  #.#.#####.#.#######.#####.#.#########.###.#.#######.#.#####.###.#.#.#.#.###.###.###.###.###########.#.#.#.#.#.###.#.#.#####.#
  #.....#...#.#...#.#.#.#...#.....#.....#...#...#.....#.#.#.....#.#.#.#.#...#...#...#.#.....#.....#.#.#.#.....#.#...#.#.#.#.#.#
  #.#####.#.#####.#.#.#.#####.#########.#.###.###.#####.#.#########.#.###.#######.#######.#.#.#.###.#.#.#####.#####.#.#.#.#.###
  #.#...#.#.#.#.#.......#.#...#...#.......#.#...#.....#.......#.....#...........#...#.#.#.#...#.........#.....#...#.......#.#.#
  #.#.#.###.#.#.#######.#.#####.#.#.###.#####.###.#.###.#########.#####.#.#.#####.###.#.#.###.###.#.#.###.###.#.###.#.#####.#.#
  #.#.#.#.#.....#.#.#.#.....#.#.#...#...#...#.#...#.#.....#.#...#.....#.#.#.#.#...#.......#...#...#.#...#.#.#...#...#.#.#.....#
  #.#.###.#.#####.#.#.#####.#.###########.###.#.###.###.###.#.#.###.#####.###.###.#.###########.###########.#.#######.#.###.#.#
  #.....#.#.#.#.......#.#...#...#.#.....#...#.#.#.#.#.....#...#...#...#.#.#.....#.#.......#...#.#...#.#.......#...#.#...#...#.#
  #.#####.#.#.#######.#.#.#####.#.###.#####.#.#.#.#####.###.#######.###.#.###.###.###.###.#.#######.#.#####.#.#.###.#.#####.###
  #...#.....#...#.#...#...#.#.................#.......#.......#.......#...#.......#...#.....#.#...#...#.....#.#...#...#.#...#.#
  #.#####.#####.#.###.#.#.#.#####.#########.#######.#######.###.#########.#.#######.#########.###.#.###.###.###.###.###.#.#.#.#
  #.....#...#...#.......#.#.#.#...#.#      G       U       S   L         N D       R        #...#.#...#.#...#.......#.....#.#.#
  #.#####.#####.#####.#.###.#.#####.#      T       O       M   H         A M       Y        ###.#.###.#####.#####.#.###.#####.#
  #.....#...#...#.....#.#.#...#...#.#                                                       #.#.#...#.#.#.......#.#...#.#...#.#
  #.#####.###.#######.#.#.#.#####.#.#                                                       #.#.#.###.#.###.#.#######.#.#.###.#
  #.#...#.#...#.....#.#.#.#.#.......#                                                     OL....#.....#.#...#.#.....#.......#.#
  #.###.#.#.#####.#####.#.#.###.#.###                                                       ###.#.#.###.#.#########.###.#.###.#
  #.#.#.........#...#.......#...#.#.#                                                       #...#.#.......#.#...#.....#.#.#...#
  #.#.###.###.###.#######.###.#####.#                                                       #.###.#####.###.#.#####.###.#.#.###
DN..#.......#.#.#.#.#.......#.#.#.#.#                                                       #...#...#...#.......#.......#.#....CU
  #.#.###.#####.#.#.###.###.#.#.#.#.#                                                       ###.#.#####.#####.#####.#####.#.#.#
  #.#...#.....#.#...#...#.........#.#                                                       #.........#...............#.#...#.#
  #.###.#.#####.###.###.#.#####.###.#                                                       #############.#############.#####.#
ZZ..#...#...#...#.#.....#.....#.#...#                                                       #...........#.#.......#.........#.#
  #.#.#####.#.#.#.#.###.#####.#####.#                                                       #.#.###.###.###.###.#######.###.#.#
  #.....#.....#.....#.....#..........HN                                                     #.#.#...#.........#.........#...#.#
  #################.#####.###########                                                       #.###.#.#.###.###.#.###.###.#.#####
  #...#.#.#.#.....#.....#.#...#.....#                                                     TG..#.#.#.#.#.....#.#...#.#...#.#....NA
  ###.#.#.#.#.#.#####.#.###.#.#.###.#                                                       ###.###.###.#######.#########.###.#
YC..#.......#.#.....#.#.#...#...#.#..DN                                                     #.....#.#.#.#.#...#.#...#.........#
  #.#####.#.#.###.#######.###.###.#.#                                                       #####.###.###.#.#######.#######.#.#
  #...#...#.#...#.#...#.....#.#...#.#                                                     YC..#...#.........#...#.....#...#.#.#
  ###.#.###.###.#.#.#.#####.#####.###                                                       #.#.#.#.#####.#.#.#.#.#.###.#####.#
  #.#...#.#.....#...#.......#.......#                                                       #.#.#.#...#.#.#...#...#.....#.#...#
  #.#####.#####################.#####                                                       #.#.#.#.###.###.###.#.#.###.#.#####
  #.......#...#.........#.....#.#.#.#                                                       #...#.......#.#.#...#.#.#.....#....JS
  #.###.###.#.#.#####.#.#.#.###.#.#.#                                                       #.###########.#.#######.#.###.#.###
  #.#.......#.....#...#...#...#......YF                                                     #...#.....#...#.#.....#.#.#.#...#.#
  #.###.#.#.###.#####.#.#.#.#.#.#.#.#                                                       #######.#####.#####.#######.###.#.#
  #...#.#.#.#.#.#...#.#.#.#.#.#.#.#.#                                                       #.......#.......#...#...#.....#.#.#
  #.#######.#.#.###.#####.###.#.#####                                                       ###.#.#.###.###.#.#.#.#.#.###.###.#
DM..#.#.#...#.#...#.#...#.#.....#...#                                                       #.#.#.#...#.#.....#.#.#.#.#.....#..YF
  #.#.#.#####.#####.#.###########.###                                                       #.#.#####.#.###.#.#.#.#.#.#####.#.#
  #.#.....#...................#.....#                                                     CD..#...#.......#.#.#.#.#.#...#...#.#
  ###.#.#########.#.###.#####.#.###.#                                                       #.#.#######.#######.#.#.###.#.###.#
OL....#...........#...#.#.....#.#.#..TK                                                     #.....#.#.#.#.........#.....#.....#
  #.###.#######.#.#.###.###.###.#.#.#                                                       #######.#.#####################.###
  #.#...#.#.#...#.#.#...#.......#...#                                                       #...#.......#...#.....#.......#.#.#
  #.#####.#.#########.#######.###.###                                                       #.#.###.###.###.###.#.#.#.#.#.###.#
CD..#.#.#.....#.#.#...#.#...#...#....UF                                                     #.#.#...#...........#.#.#.#.#...#..GT
  ###.#.###.###.#.###.#.#.###.###.###                                                       ###.###.###.#####.###.#.###.#.###.#
  #.................#.#.....#...#.#.#                                                     JS..#.....#.....#.#...#.....#.#.#...#
  #.#####.#######.#####.#.#.#.#####.#                                                       #.#.#.#.#######.#####.#.#####.#.###
  #.....#.#...#...#.....#.#.#.#.#.#..AC                                                     #...#.#.#.#.#.#...#...#...#.#...#.#
  #####.#######.#.###.#.#######.#.#.#                                                       #########.#.#.#.###########.#####.#
  #...#.#.......#.#...#...#.....#...#                                                       #...#.....#.......#.#.............#
  #.###.#####.#######.###.#.#.#.#.###                                                       ###.#.#.###.#.#.###.#.###.#.###.###
BM......#.............#.#...#.#.....#                                                       #.....#.....#.#.#...#.#.#.#.#...#.#
  ###########.#.#######.#############                                                       #.#######.#.#.#####.###.#.#.###.#.#
DH..#.......#.#.#...........#.....#.#                                                       #.....#...#.#.....#.#...#.#...#....UO
  #.#.#####.#####.#.###.#######.#.#.#                                                       ###.###.#####.#####.###.#####.#.###
  #.#...#.......#.#.#.....#...#.#...#                                                     BM......#.#.....................#...#
  #.###.#######.#.#.###.###.###.###.#                                                       #################################.#
  #...#.....#...#.#.#...#...#...#...#                                                       #.......#.............#.........#.#
  #.#.#.#####.###.#.###.#.#.#.###.###                                                       #.#####.###.#####.###.#.#.#.#.#####
  #.#.....#.......#.#.....#...#.#....CU                                                   GN......#.#...#.#...#.#.#.#.#.#.....#
  #.#.###.#.#####.#####.#####.#.#.#.#                                                       #######.#.###.###.#.#.#.#####.#.###
  #.#.#...#.#.#.....#.#...#.....#.#.#                                                       #.#.....#.......#.#.........#.#....OY
  #.#.#######.#.#####.#.#.#####.#####                                                       #.#.#########.#########.#.#.###.#.#
  #.#...#.........#.....#.#.........#                                                       #.................#.#...#.#...#.#.#
  #####.#######.#.###.###.#.#.###.#.#    X         O           D D         R     K          #####.#.###.###.#.#.###.###.###.###
  #...#.......#.#.#.#...#.#.#.#...#.#    M         Y           H B         W     N          #.....#...#.#.#.#.#.......#...#...#
  #.###.#####.###.#.#.#.#.###.#.#.#######.#########.###########.#.#########.#####.###########.#.#.#.#.#.#.#.#.###.#####.###.###
  #.........#...#...#.#.#...#.#.#...#.......#.....#.....#.#.....#...#.#.#...#...........#...#.#.#.#.#.#...#.#.#.......#.#.#...#
  ###.#.#####.#######.#.###.###.#.#######.###.#.#####.###.#####.#.###.#.#.#############.###.###.###.#.#.#.#######.#####.#.#.###
  #.#.#...#...#.......#...#...#.#.#.........#.#.#.......#.......#...#...#.....#.#.#...........#.#...#.#.#.....#.#...#.....#...#
  #.###.#.#.#####.###.#.###.#.#####.#####.#.#.#.#.#####.#.#.#######.#.#.#.#####.#.#.#.#.#.#.#.#.###.#########.#.#######.###.#.#
  #.....#.#.....#.#...#.#.#.#.#...#.#.....#...#.#.#.....#.#.....#.....#.#.......#...#.#.#.#.#.#.#.#.........#.#...........#.#.#
  #####.###.#.#.#.###.###.#####.#.###.#########.###.#.###.#######.#.###.#######.#.#########.###.#.#.#####.#####.#.###.#.#.#.#.#
  #.#.....#.#.#.#...#.#.#.#.#.#.#...#.#.........#...#.#.#.......#.#.#...#.#.....#.......#.....#.#.....#.......#.#.#...#.#.#.#.#
  #.#.#.###.#.#####.###.#.#.#.#.#########.#.#.###.#####.#.#######.#.###.#.###.#####.#.#######.###.###.#########.#.###.#.#####.#
  #...#...#.#.#.#...#.#.......#...#.#.#.#.#.#.#...#.....#.#.#.#.#.#.#...#.....#.#...#.....#.....#.#...........#.#...#.#...#...#
  #.###.#######.#####.#####.###.#.#.#.#.###.#####.#.###.#.#.#.#.#######.#.#.###.#####.#.#.###.#########.#.#.#######.#.###.###.#
  #.#.........#.#.#...#.....#...#...........#.#.....#...#...#...#...#...#.#...#.......#.#...#...#.#.....#.#.#.#.#.#.#...#.#...#
  #.###.###.###.#.###.#.#.#.#####.###.#####.#.#######.###.###.###.#####.#.#######.#.#.###########.###.#.###.#.#.#.###.#.###.#.#
  #.#...#.........#.....#.#...#.....#.#.........#.....#.....#.#.#.#.....#.....#...#.#...#.#...#...#.#.#.#...........#.#.#...#.#
  #.#.#.#####.#.#############.###.###.#####.#.#.#.###.###.###.#.#.#####.###.###.#.###.###.#.###.###.#.#####.#.#.#.#.###.#####.#
  #.#.#...#...#.#...#.............#.#.#.....#.#.#.#...#...............#.#...#.#.#.#.#.......#.#.#.#.....#...#.#.#.#...#...#...#
  #.###.###.#####.#.#.###.#########.###########.#.###.###.###.#.#######.#.#.#.###.#.###.###.#.#.#.###.#####.###.#########.###.#
  #.#.....#.....#.#...#...#.....#.#.#...#.......#...#.#.#.#.#.#...#.#...#.#.....#...#.#...#.#.......#.#.....#.......#.......#.#
  #.###.#####.#####.###.#.#####.#.#.###.#####.###.#####.#.#.#######.###.#.#######.###.###.###.#.###########.#####.###.#.#.#.###
  #.#...#.....#.....#...#.#.#.......#.#...#.#...#.....#.........#.#.....#.....#.......#.#.#...#.#...#.#.#.....#...#.#.#.#.#.#.#
  #.#.#.#############.#####.###.#.###.###.#.###.###.#####.#######.#####.#.#.#####.#####.#.#####.###.#.#.#.###.###.#.#.###.###.#
  #.#.#.#...#.#.#.......#.......#.....#...#.....#.......#.....#.........#.#.#...#.#.#.....#.#...........#...#.#.#...#.#.......#
  #.#######.#.#.###.###########.#.###.###.###.###.#.#####.###########.###.#####.#.#.#####.#.#.#####.#.###.#.###.###.###.#####.#
  #.#.#...#...#.#.#.#.#.#.#.#.#.#.#.........#.#...#...#...#...#.......#.........#.#.#...#.#.......#.#...#.#...#...#.#.......#.#
  #.#.#.#####.#.#.###.#.#.#.#.#.###.#####.#.#.###.#####.#.###.###.#.#######.#####.#.#.#####.#####.###.###.#####.#####.#.#######
  #...#.....#...#...#...........#...#.....#.....#.....#.#.......#.#.#...#.....#.#...#.......#.#...#.#...#.#.........#.#.......#
  #.#######.###.###.###.#.###############.#######.###.#.#.#########.###.#.#.###.#.###.#.#####.#####.#####.###.###.#######.#.#.#
  #.#...#.............#.#.#.#...................#.#.#.#.#.....#.#.......#.#.#.#...#...#.....#.#...#.....#.#.#.#.#...#.#...#.#.#
  #.###.###.#.###.#########.###.#######.###.###.#.#.#.#####.#.#.#######.#.###.###.#.###.#####.#.#######.###.#.#.#####.#.#.#.###
  #.#.#.#...#.#.......#.........#.......#.....#.#.#.#.#.#...#.#.......#.#.......#.#...#.#.#.......#.................#...#.#...#
  ###.#.#.#########.#.###.#.###.###.#####.###.#####.#.#.#.#######.#.###.#.###.###.#.#####.###.#.###.#######.#####.#.#.###.#.#.#
  #...#...#.........#.....#.#...#...#.#.....#.#.#.....#...#.....#.#.#...#...#.#...............#...........#.....#.#.#.#...#.#.#
  #.#.###.#.#####.###.#.#.#.###.#.###.#.###.###.#.#####.#.#.###.#.#.#.###.#####.###.#.#.###.###.###.#.#######.#########.#.#.###
  #.#.....#.#.....#...#.#.#...#.#.#.....#.......#.....#.#...#...#.#...#.......#.#...#.#...#.#.....#.#.......#.......#...#.#...#
  #########################################.#######.#######.###.#.###########.#####.###########################################
                                           T       T       A   G K           X     H
                                           K       G       A   N N           M     N                                             """
FLOOR = '.'

def read_portal(lines, x, y):
	"""x,y is a potential portal spot."""
	for (a,b) in [[(-2, 0), (-1, 0)], [(1,0), (2,0)], [(0, -2), (0, -1)], [(0, 1), (0, 2)]]:
		try:
			if lines[y][x] != '.':
				return False
			ac = lines[y + a[1]][x + a[0]]
			bc = lines[y + b[1]][x + b[0]]
			
			name = (ac + bc).strip()
			if len(name) != 2:
				continue
			if '.' in name or '#' in name:
				continue
			return name
		except:
			continue
	return False
	
def find_portals(lines):
	portal_to_pos = {}
	pos_to_portal = {}
	
	for y in range(len(lines)):
		for x in range(len(lines[y])):
			portal = read_portal(lines, x, y)
			if not portal:
				continue
			if portal in portal_to_pos:
				portal = portal.lower()
			portal_to_pos[portal] = (x, y)
			pos_to_portal[(x, y)] = portal
			
	return [portal_to_pos, pos_to_portal]
	
def paired_portal(portal, portal_to_pos):
	if othercase(portal) in portal_to_pos:
		return portal_to_pos[othercase(portal)]
		
	return False
	
def get_around(pos, lines):
	around = []
	for dir in [(-1, 0), (1, 0), (0, 1), (0, -1)]:
		try:
			x = pos[0] + dir[0]
			y = pos[1] + dir[1]
			if lines[y][x] == FLOOR:
				around.append((x, y, pos[2]))
		except:
			continue
	return around
	
def othercase(string):
	if string.upper() == string:
		return string.lower()
	else:
		return string.upper()
		
def portal_out(portals, poses, pos):
	(x, y, z) = pos
	if (x,y) not in poses:
		return None
	p = poses[(x, y)]
	
	level0 = p == 'AA' or p == 'ZZ'
	inner = x > 4 and x < 120 and y > 5 and y < 130
	if z == 0:
		if not inner or level0:
			return None
		(ox, oy) = paired_portal(p, portals)
		return (ox, oy, z + 1)
		
	else:
		if level0:
			return None
		(ox, oy) = paired_portal(p, portals)
		if inner:
			return (ox, oy, z+1)
		else:
			return (ox, oy, z-1)
	assert False

def make_visited(lines):
	visited = [[0] * len(lines[3]) for y in range(len(lines))]
	return visited

def bfs_lines(lines):
	lines = split_lines(lines)
	print(len(lines))
	[portal_to_pos, pos_to_portal] = find_portals(lines)
	#print(portal_to_pos)
	#print(portal_to_pos['AA'], '->', portal_to_pos['ZZ'])
	#print(othercase('AA'), othercase('aa'))
	visited = [make_visited(lines)]
	
	
	(sx, sy) = portal_to_pos['AA']
	(ex, ey) = portal_to_pos['ZZ']
	end = (ex,ey,0)
	
	search = [((sx,sy,0), 0)]
	while search:
		[pos, steps] = search[0]
		search = search[1:]
		(px, py, pz) = pos
		if pz == len(visited):
			visited += [make_visited(lines)]
			print('level ', len(visited))
		
		if visited[pz][py][px]:
			continue
		visited[pz][py][px] = steps + 1
		#print(pos)
		if pos == end:
			print('Found! ', steps)
			return 

		po = portal_out(portal_to_pos, pos_to_portal, pos)
		if po:
			search.append((po, steps + 1))

		around = get_around(pos, lines)
		for a in around:
			search.append((a, steps + 1))
			
def printit(lines, visited):
	for y in range(len(lines)):
		for x in range(len(lines[y])):
			if visited[y][x]:
				lines[y][x] = str(visited[y][x] % 10)
	for y in range(len(lines)):
		print(''.join(lines[y]).rstrip())
		
def split_lines(lines):
	board = []
	for y in range(len(lines)):
		line = []
		for x in range(len(lines[y])):
			line.append(lines[y][x])
		board.append(line)
	return board
	
def part1(lines):
	bfs_lines(lines)
	
part1(INPUT.split('\n'))

